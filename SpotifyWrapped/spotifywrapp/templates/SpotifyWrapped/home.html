{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spotify Tarot Reading</title>
    <link rel="stylesheet" href="{% static 'SpotifyWrapped/home.css' %}">
</head>
<body>
<div class="dark-header container">
    <div class="left">
        <a href="{% url 'home' %}">Home</a>
        <a href="{% url 'readings' %}">Past Readings</a>
        <a href="{% url 'about_us' %}">About Us</a>
    </div>
    <div class="right">
        <a href="{% url 'profile' %}">Profile</a>
    </div>
</div>


<div class="main container fade">
    <div class="main-items">
        <div class="orb-container fade-longer">
            <img src="{% static 'SpotifyWrapped/images/decorations/orb/dark-orb.svg' %}" id="orb" class="floating">
            <img src="{% static 'SpotifyWrapped/images/decorations/orb/dark-star.svg' %}" id="star" class="floating">
            <div class="moon-ring-container">
                <img src="{% static 'SpotifyWrapped/images/decorations/moonring.svg' %}" id="moon-ring" alt="Moonring"
                     width="100%">
            </div>
        </div>
        <a href="{% url 'select_date' %}" id="expand-link">Create a Spotify Reading</a>
        <script>
            document.getElementById("expand-link").addEventListener("click", function (event) {
                event.preventDefault();
                const star = document.getElementById("star");

                star.classList.add("expand");

                setTimeout(function () {
                    window.location.href = "{% url 'select_date' %}";
                }, 1000);
            });
        </script>
    </div>

    <div class="readings container">
        <h2>Recent Readings</h2>
        <div class="cards">
            <script>
                function showPopup(id, date, cardContainer) {
                    document.getElementById('popupTitle').textContent = `Wrap Date: ${date}`;
                    document.getElementById('deleteId').value = id;
                    document.getElementById('displayId').value = id;

                    // Show the popup
                    const modal = document.getElementById('popupModal');
                    modal.style.display = 'flex';

                    // Add "hovered" class to the card container
                    document.querySelectorAll('.card-container').forEach(card => card.classList.remove('hovered')); // Ensure only one card is hovered
                    cardContainer.classList.add('hovered');
                }

                function closePopup() {
                    // Hide the popup
                    const modal = document.getElementById('popupModal');
                    modal.style.display = 'none';

                    // Remove "hovered" class from all card containers
                    const cards = document.querySelectorAll('.card-container');
                    cards.forEach(card => card.classList.remove('hovered'));
                }

                // Prevent closing the popup when clicking inside the popup content
                document.getElementById('popupModal').addEventListener('click', function (event) {
                    const popupContent = document.querySelector('.popup-content');
                    if (!popupContent.contains(event.target)) {
                        closePopup();
                    }
                });
            </script>

            <div id="popupModal" class="popup-container">
                <div class="popup-content">
                    <span class="close-btn" onclick="closePopup()">&times;</span>
                    <div class="text">
                        <p id="popupTitle">Wrap Date</p>
                        <p>Will you revisit the stars of your past Wrapped or release it to the universe?</p>
                    </div>
                    <div class="buttons">
                        <form class="invites" method="post" action="{% url 'readings' %}">
                            {% csrf_token %}
                            <input type="hidden" id="deleteId" name="id" value="">
                            <button class="delete" type="submit">Delete</button>
                        </form>
                        <form class="invites" method="post" action="">
                            {% csrf_token %}
                            <input type="hidden" id="displayId" name="id" value="">
                            <button class="display" type="submit">View</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="cards">
                {% for item in recent %}
                    <div class="card-container"
                         onclick="showPopup('{{ item.id }}', '{{ item.date }}', '{{ item.duration }}', '{{ item.image }}')">
                        <div class="main-card">
                            <svg viewBox="0 0 200 315" class="card-back"></svg>
                            <div class="card-front">
                                <img src="{{ item.image }}">
                                <div class="card-text-overlay">
                                    <p class="top-text">{{ item.date|date:"m.d.y" }}</p>
                                    <p class="bottom-text">{{ item.duration }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="fanned-card">
                            <svg viewBox="0 0 200 315" class="card-back"></svg>
                        </div>
                        <div class="fanned-card">
                            <svg viewBox="0 0 200 315" class="card-back"></svg>
                        </div>
                        <div class="fanned-card">
                            <svg viewBox="0 0 200 315" class="card-back"></svg>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

</body>
</html>