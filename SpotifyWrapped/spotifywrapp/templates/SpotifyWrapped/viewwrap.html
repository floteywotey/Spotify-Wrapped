{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Wrap</title>
    <link rel="stylesheet" href="{% static 'SpotifyWrapped/viewwrap.css' %}">
</head>
<body>
<div class="header">
    <form class="home" action="{% url 'home' %}" method="post">
        {% csrf_token %}
        <button class="home-button" aria-label="Home" title="Home">
            <span class="close-icon"></span>
        </button>
    </form>
</div>

<div class="cards">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const cards = document.querySelectorAll(".card");
            const arcWidth = 800; // Total arc width in pixels
            const maxAngle = 30; // Maximum angle for rotation in degrees

            cards.forEach((card, index) => {
                const totalCards = cards.length;
                const middleIndex = (totalCards - 1) / 2;
                const offset = index - middleIndex; // Offset from the center card
                const angle = offset * (maxAngle / middleIndex); // Calculate rotation angle
                let spread = offset * (arcWidth / totalCards); // Calculate horizontal position

                if (index === 0 || index === totalCards - 1) {
                    spread *= 1.2; // Slightly increase spread for the first and last cards
                }

                card.style.setProperty("--angle", `${angle}deg`);
                card.style.setProperty("--spread", `${spread}px`);
            });

            document.body.classList.add("no-hover");
            setTimeout(() => {
                // Add the no-hover class to disable hover effects

                // Start fan-out animation
                cards.forEach((card) => {
                    card.classList.add("fanned");
                });

                // After fan-out animation, start staggered move-down
                setTimeout(() => {
                    cards.forEach((card, index) => {
                        setTimeout(() => {
                            card.classList.add("moved");
                        }, index * 200); // Apply staggered delay
                    });

                    // Remove no-hover after all staggered animations are complete
                    const totalAnimationTime = cards.length * 200 + 2500; // Stagger duration + move-down animation
                    setTimeout(() => {
                        document.body.classList.remove("no-hover");
                    }, totalAnimationTime);
                }, 3000); // Delay for fan-out animation to complete
            }, 1000); // Initial delay

            cards.forEach((card) => {
                card.addEventListener("click", () => {
                    if (card.classList.contains("centered")) {
                        // If the card is already centered, remove the 'centered' class
                        card.classList.remove("centered");
                    } else {
                        // Remove the 'centered' class from all cards
                        cards.forEach((c) => c.classList.remove("centered"));

                        // Add the 'centered' class to the clicked card
                        card.classList.add("centered");
                    }
                });
            });
        });
    </script>
    <div class="card card1" id="card1">
        <div class="card-back" id="back1">
            <div class="card-front" id="front1">
                <div class="info fade">
                    <h1>Top Tracks</h1>
                    {% for track in wrap.wrap1.top5tracks %}
                        <div class="details">
                            <img src="{{ track.image }}" height="95px" width="95px">
                            <div class="bullet">
                                <img class="fbullet-img" data-index="{{ forloop.counter }}" height="50px" width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ track.name }}</h2>
                                <h3>{{ track.artists }}</h3>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="card card2" id="card2">
        <div class="card-back" id="back2">
            <div class="card-front" id="front2">
                <div class="info fade">
                    <h1>Top Artists</h1>
                    {% for artist in wrap.wrap1.top5artists %}
                        <div class="details">
                            <img src="{{ artist.image }}" width="95px" height="95px">
                            <div class="bullet">
                                <img class="fbullet-img" data-index="{{ forloop.counter }}" height="50px" width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ artist.name }}</h2>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="card card3" id="card3">
        <div class="card-back" id="back3">
            <div class="card-front" id="front3">
                <div class="info fade">
                    <h1>Top Genres</h1>
                    {% for genre in wrap.wrap1.top5genres %}
                        <div class="details">
                            <div class="bullet">
                                <img class="fbullet-img" data-index="{{ forloop.counter }}" height="50px" width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ genre }}</h2>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="card card4" id="card4">
        <div class="card-back" id="back4">
            <div class="card-front" id="front4">
                <div class="info fade">
                    <div class="top">
                        <p>In the vastness of our infinite galaxy, you decided to travel all throughout it with your
                            limited
                            time of life.</p>
                    </div>
                    <div class="bottom">
                        <p>You listened to {{ wrap.wrap1.num_genres }} genres.<br>
                            Look at you little explorer. Did you have fun?</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card card5 {% if wrap.wrap1.danceability > 50 %}high-danceability{% else %}low-danceability{% endif %}"
         id="card5">
        <div class="card-back" id="back5">
            <div class="card-front" id="front5">
                <div class="info fade varlow" id="info5-varlow">
                    <div class="scenario">
                        <p>Your music drifts in cosmic dust, where a lone comet passes by, playing gentle and
                            introspective
                            rhythm filling your journey with a familiar and comforting emptiness. These tracks are for
                            solitary star gazing as you float through universe.</p>
                        <p>Your average danceability: {{ wrap.wrap1.danceability }}%.</p>
                        {% for track in wrap.wrap1.bot3danceability %}
                            <div class="details">
                                <img src="{{ track.image }}" width="95px" height="95px">
                                <div class="bullet">
                                    <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                         width="50px">
                                </div>
                                <div class="text">
                                    <h2>{{ track.name }}</h2>
                                    <h3>{{ track.artists }}</h3>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="info fade varhigh" id="info5-varhigh">
                    <div class="scenario">
                        <p>Your music bursts like supernovas, with each burst creating vibrant and groovy beats that
                            make you lose yourself in a cosmic dance. These tracks are for playfully jumping around
                            through
                            different constellations and showing off your sparkle.</p>
                        <p>Your average danceability: {{ wrap.wrap1.danceability }}%.</p>
                    </div>
                    {% for track in wrap.wrap1.top3danceability %}
                        <div class="details">
                            <img src="{{ track.image }}" width="95px" height="95px">
                            <div class="bullet">
                                <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                     width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ track.name }}</h2>
                                <h3>{{ track.artists }}</h3>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <script>
                const danceability = {{ wrap.wrap1.danceability }};

                function addDanceabilityId() {
                    const element = document.getElementById('front5');

                    if (danceability < 50) {
                        element.id = "front5-varlow";
                    } else {
                        element.id = "front5-varhigh";
                    }
                }

                function setupDanceabilityInfo() {
                    const card = document.querySelector(".card5");
                    const lowInfo = document.getElementById("info5-varlow");
                    const highInfo = document.getElementById("info5-varhigh");

                    card.addEventListener("mouseenter", () => {
                        // Show info only if the card has the .centered class
                        if (card.classList.contains("centered")) {
                            if (danceability < 50) {
                                lowInfo.style.display = "flex";
                                highInfo.style.display = "none";
                            } else {
                                lowInfo.style.display = "none";
                                highInfo.style.display = "flex";
                            }
                        }
                    });

                    card.addEventListener("mouseleave", () => {
                        // Hide the info regardless of the centered state
                        lowInfo.style.display = "none";
                        highInfo.style.display = "none";
                    });
                }

                document.addEventListener("DOMContentLoaded", () => {
                    addDanceabilityId();
                    setupDanceabilityInfo();
                });
            </script>
        </div>
    </div>

    <div class="card card6 {% if wrap.wrap1.energy > 50 %}high-energy{% else %}low-energy{% endif %}" id="card6">
        <div class="card-back" id="back6">
            <div class="card-front" id="front6">
                <div class="info fade varlow" id="info6-varlow">
                    <div class="scenario">
                        <p>Your music gently orbits at its own slow, deliberate pace, emitting a soft glow like distant
                            stars, filling your space with a sense of peace. These tracks are for quiet moments,
                            creating a
                            reflective atmosphere that keeps you grounded amidst the stars.</p>
                        <p>Your average energy: {{ wrap.wrap1.energy }}%.</p>
                        {% for track in wrap.wrap1.bot3energy %}
                            <div class="details">
                                <img src="{{ track.image }}" width="95px" height="95px">
                                <div class="bullet">
                                    <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                         width="50px">
                                </div>
                                <div class="text">
                                    <h2>{{ track.name }}</h2>
                                    <h3>{{ track.artists }}</h3>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="info fade varhigh" id="info6-varhigh">
                    <div class="scenario">
                        <p>Your music roars through space, pulsating with restless energy and fueling an unstoppable
                            journey
                            forward. These tracks are filled with cosmic adrenaline and vibrant determination, pushing
                            you
                            beyond the known universe.</p>
                        <p>Your average energy: {{ wrap.wrap1.energy }}%.</p>
                    </div>
                    {% for track in wrap.wrap1.top3energy %}
                        <div class="details">
                            <img src="{{ track.image }}" width="95px" height="95px">
                            <div class="bullet">
                                <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                     width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ track.name }}</h2>
                                <h3>{{ track.artists }}</h3>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <script>
                const energy = {{ wrap.wrap1.energy }};

                function addEnergyId() {
                    const element = document.getElementById('front6');

                    if (energy < 50) {
                        element.id = "front6-varlow";
                    } else {
                        element.id = "front6-varhigh";
                    }
                }

                function setupEnergyInfo() {
                    const card = document.querySelector(".card6");
                    const lowInfo = document.getElementById("info6-varlow");
                    const highInfo = document.getElementById("info6-varhigh");

                    card.addEventListener("mouseenter", () => {
                        // Show info only if the card has the .centered class
                        if (card.classList.contains("centered")) {
                            if (energy < 50) {
                                lowInfo.style.display = "flex";
                                highInfo.style.display = "none";
                            } else {
                                lowInfo.style.display = "none";
                                highInfo.style.display = "flex";
                            }
                        }
                    });

                    card.addEventListener("mouseleave", () => {
                        // Hide the info regardless of the centered state
                        lowInfo.style.display = "none";
                        highInfo.style.display = "none";
                    });
                }

                document.addEventListener("DOMContentLoaded", () => {
                    addEnergyId();
                    setupEnergyInfo();
                });
            </script>
        </div>
    </div>

    <div class="card card7 {% if wrap.wrap1.popularity > 50 %}high-popularity{% else %}low-popularity{% endif %}"
         id="card7">
        <div class="card-back" id="back7">
            <div class="card-front" id="front7">
                <div class="info fade varlow" id="info7-varlow">
                    <div class="scenario">
                        <p>Your music is a hidden nebula in uncharted territory, a secret only a few have wandered into.
                            These tracks echo distantly in the quiet parts of the galaxy, a unique and quiet beauty
                            valued
                            only by those who appreciate the obscure.</p>
                        <p>The popularity of your songs: {{ wrap.wrap1.popularity }}%.</p>
                        {% for track in wrap.wrap1.bot3popularity %}
                            <div class="details">
                                <img src="{{ track.image }}" width="95px" height="95px">
                                <div class="bullet">
                                    <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                         width="50px">
                                </div>
                                <div class="text">
                                    <h2>{{ track.name }}</h2>
                                    <h3>{{ track.artists }}</h3>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="info fade varhigh" id="info7-varhigh">
                    <div class="scenario">
                        <p>Your music is a beacon on a well charted star map, drawing all celestial galaxies into your
                            orbit. These tracks left permanent tracks across space and time, transcending and enduring
                            as
                            constellations told about by generations.</p>
                        <p>The popularity of your songs: {{ wrap.wrap1.popularity }}%.</p>
                    </div>
                    {% for track in wrap.wrap1.top3popularity %}
                        <div class="details">
                            <img src="{{ track.image }}" width="95px" height="95px">
                            <div class="bullet">
                                <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                     width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ track.name }}</h2>
                                <h3>{{ track.artists }}</h3>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <script>
                const popularity = {{ wrap.wrap1.popularity }};

                function addPopularityId() {
                    const element = document.getElementById('front7');

                    if (popularity < 50) {
                        element.id = "front7-varlow";
                    } else {
                        element.id = "front7-varhigh";
                    }
                }

                function setupPopularityInfo() {
                    const card = document.querySelector(".card7");
                    const lowInfo = document.getElementById("info7-varlow");
                    const highInfo = document.getElementById("info7-varhigh");

                    card.addEventListener("mouseenter", () => {
                        // Show info only if the card has the .centered class
                        if (card.classList.contains("centered")) {
                            if (popularity < 50) {
                                lowInfo.style.display = "flex";
                                highInfo.style.display = "none";
                            } else {
                                lowInfo.style.display = "none";
                                highInfo.style.display = "flex";
                            }
                        }
                    });

                    card.addEventListener("mouseleave", () => {
                        // Hide the info regardless of the centered state
                        lowInfo.style.display = "none";
                        highInfo.style.display = "none";
                    });
                }

                document.addEventListener("DOMContentLoaded", () => {
                    addPopularityId();
                    setupPopularityInfo();
                });
            </script>
        </div>
    </div>

    <div class="card card8 {% if wrap.wrap1.valence > 50 %}high-valence{% else %}low-valence{% endif %}" id="card8">
        <div class="card-back" id="back8">
            <div class="card-front" id="front8">
                <div class="info fade varlow" id="info8-varlow">
                    <div class="scenario">
                        <p>Your music drifts in the shadows, embracing the dark of side of each celestial body like the
                            veil
                            of night. These tracks are like a haunting echo, painting a soundscape of quiet allure and
                            melancholy that helps you find companionship with the void.</p>
                        <p>Your average positivity: {{ wrap.wrap1.valence }}%.</p>
                        {% for track in wrap.wrap1.bot3valence %}
                            <div class="details">
                                <img src="{{ track.image }}" width="95px" height="95px">
                                <div class="bullet">
                                    <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                         width="50px">
                                </div>
                                <div class="text">
                                    <h2>{{ track.name }}</h2>
                                    <h3>{{ track.artists }}</h3>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="info fade varhigh" id="info8-varhigh">
                    <div class="scenario">
                        <p>Your music blazes solar flares, erupting with a vibrant horizon of golden waves and
                            illuminating
                            the darkest corners with warmth. These tracks remind you of the beauty in everything, that
                            even
                            in dark space, light and joy can thrive.</p>
                        <p>Your average positivity: {{ wrap.wrap1.valence }}%.</p>
                    </div>
                    {% for track in wrap.wrap1.top3valence %}
                        <div class="details">
                            <img src="{{ track.image }}" width="95px" height="95px">
                            <div class="bullet">
                                <img class="tbullet-img" data-index="{{ forloop.counter }}" height="50px"
                                     width="50px">
                            </div>
                            <div class="text">
                                <h2>{{ track.name }}</h2>
                                <h3>{{ track.artists }}</h3>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <script>
                const valence = {{ wrap.wrap1.valence }};

                function addValenceId() {
                    const element = document.getElementById('front8');

                    if (valence < 50) {
                        element.id = "front8-varlow";
                    } else {
                        element.id = "front8-varhigh";
                    }
                }

                function setupValenceInfo() {
                    const card = document.querySelector(".card8");
                    const lowInfo = document.getElementById("info8-varlow");
                    const highInfo = document.getElementById("info8-varhigh");

                    card.addEventListener("mouseenter", () => {
                        // Show info only if the card has the .centered class
                        if (card.classList.contains("centered")) {
                            if (valence < 50) {
                                lowInfo.style.display = "flex";
                                highInfo.style.display = "none";
                            } else {
                                lowInfo.style.display = "none";
                                highInfo.style.display = "flex";
                            }
                        }
                    });

                    card.addEventListener("mouseleave", () => {
                        // Hide the info regardless of the centered state
                        lowInfo.style.display = "none";
                        highInfo.style.display = "none";
                    });
                }

                document.addEventListener("DOMContentLoaded", () => {
                    addValenceId();
                    setupValenceInfo();
                });
            </script>
        </div>
    </div>

    <div class="card card9" id="card9">
        <div class="card-back" id="back9">
            <div class="card-front">
                <div class="info fade">
                    <div class="images">
                        {% for artist in wrap.wrap1.top5artists|slice:":1" %}
                            <img id="artist" src="{{ artist.image }}" width="250" height="250">
                        {% endfor %}
                        <img id="decor" src="{% static 'SpotifyWrapped/images/decorations/summary-decor.svg' %}"
                             width="450"
                             height="450">
                    </div>
                    <div class="details">
                        <div class="left">
                            <div class="artists">
                                <p class="title">Top Artists</p>
                                <ol>
                                    {% for artist in wrap.wrap1.top5artists %}
                                        <li><span class="number">{{ forloop.counter }}.</span> {{ artist.name }}</li>
                                    {% endfor %}
                                </ol>
                            </div>
                            <div class="personalities">
                                <p class="title">Listening Personalities</p>
                                <ol>
                                    <li><span class="number">1.</span> {% if wrap.wrap1.danceability > 50 %} The
                                        Jester {% else %} The Hermit {% endif %}</li>
                                    <li><span class="number">2.</span> {% if wrap.wrap1.energy > 50 %} The
                                        Sage {% else %}
                                        The Chariot {% endif %}</li>
                                    <li><span class="number">3.</span> {% if wrap.wrap1.ppopularity > 50 %} The
                                        Rogue {% else %} The Bard {% endif %}</li>
                                    <li><span class="number">4.</span> {% if wrap.wrap1.valence > 50 %} The
                                        Moon {% else %}
                                        The Sun {% endif %}</li>
                                </ol>
                            </div>
                        </div>
                        <div class="right">
                            <div class="songs">
                                <p class="title">Top Tracks</p>
                                <ol>
                                    {% for artist in wrap.wrap1.top5tracks %}
                                        <li><span class="number">{{ forloop.counter }}.</span> {{ artist.name }}</li>
                                    {% endfor %}
                                </ol>
                            </div>
                            <div class="genres">
                                <p class="title">Total Genres</p>
                                <p class="subtitle">{{ wrap.wrap1.num_genres }}</p>
                            </div>
                            <div class="genres">
                                <p class="title">Top Genre</p>
                                <p class="subtitle">
                                    {% for genre in wrap.wrap1.top5genres|slice:":1" %}
                                        {{ genre }}
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const bulletImages = document.querySelectorAll('.fbullet-img');

            bulletImages.forEach(function (bullet, index) {
                const bulletImages = [
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet1.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet2.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet3.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet4.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet5.svg' %}"
                ];

                bullet.src = bulletImages[index % bulletImages.length];
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            const bulletImages = document.querySelectorAll('.tbullet-img');

            bulletImages.forEach(function (bullet, index) {
                const bulletImages = [
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet1.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet2.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet3.svg' %}"
                ];

                bullet.src = bulletImages[index % bulletImages.length];
            });
        });
    </script>
</div>
</body>
</html>