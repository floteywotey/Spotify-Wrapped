{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Wrapped</title>
    <link rel="stylesheet" href="{% static 'SpotifyWrapped/duo_results.css' %}">
</head>
<body>
<div class="header">
    <form class="home" action="{% url 'home' %}" method="post">
        {% csrf_token %}
        <button class="home-button" aria-label="Home" title="Home">
            <img src="{% static 'SpotifyWrapped/images/icons/close_presentation.svg' %}" height="30px" width="30px">
        </button>
    </form>
</div>
<div class="cards">
    <div class="card1" id="card">
        <div class="card-back" id="back1"></div>
        <div class="card-front" id="front1">
            <div class="info fade">
                <h1>Top Songs</h1>
                {% for track in wrap.duowrap.top_tracks|slice:":5" %}
                    <div class="details">
                        <img src="{{ track.image }}" height="33" width="33">
                        <div class="bullet">
                            <img class="fbullet-img" data-index="{{ forloop.counter }}" height="10px" width="10px">
                        </div>
                        <div class="text">
                            <h2>{{ track.name }}</h2>
                            <h3>{{ track.artists }}</h3>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
function splitCard(card) {
    const front = card.querySelector(".card-front");
    // Ensure card-front is visible before splitting
    front.style.opacity = "0";
    // Create split elements
    const leftHalf = document.createElement("div");
    leftHalf.classList.add("split-left");

    const rightHalf = document.createElement("div");
    rightHalf.classList.add("split-right");

    // Append split halves to the card
    card.appendChild(leftHalf);
    card.appendChild(rightHalf);

    // Remove split elements after animation completes
    // Remove split halves after animation
    setTimeout(() => {
        leftHalf.remove();
        rightHalf.remove();

        // Fade the front card back in
        front.style.opacity = "1";
    }, 3000); // Wait for split and merge animations to complete
}
let isAnimating = false;
// Add event listener to cards
document.querySelectorAll(".card1").forEach(card => {
    card.addEventListener("click", function () {
        // Prevent interaction if already animating
        if (isAnimating) return;

        // Set flag to true
        isAnimating = true;
        // Flip the card
        card.classList.toggle("clicked");

        // Trigger split animation after flipping
        setTimeout(() => {
            if (card.classList.contains("clicked")) {
                splitCard(card);
            }
        }, 600); // Matches flip animation duration
        // Reset flag after the entire animation ends
        setTimeout(() => {
            isAnimating = false;
        }, 3000); // Match total animation duration
    });
});
        });

document.addEventListener("DOMContentLoaded", function () {
            const bulletImages = document.querySelectorAll('.fbullet-img');

            bulletImages.forEach(function (bullet, index) {
                const bulletImages = [
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet1.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet2.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet3.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet4.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet5.svg' %}"
                ];

                bullet.src = bulletImages[index % bulletImages.length];
            });
        });
    </script>
</body>
</html>