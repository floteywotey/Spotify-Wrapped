{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Wrapped</title>
    <link rel="stylesheet" href="{% static 'SpotifyWrapped/duo_results.css' %}">
</head>
<body>
<div class="header">
    <form class="home" action="{% url 'home' %}" method="post">
        {% csrf_token %}
        <button class="home-button" aria-label="Home" title="Home">
            <img src="{% static 'SpotifyWrapped/images/icons/close_presentation.svg' %}" height="30px" width="30px">
        </button>
    </form>
</div>

<div class="cards">
    <div class="card1" id="card">
        <!-- Card Back -->
        <div class="card-back" id="back1"></div>

        <!-- Card Front -->
        <div class="card-front" id="front1">
            <!-- Info for shared tracks -->
            <div class="info fade" id="info1">
                <div class="scenario">
                    <p>The cards reveal harmony—your musical fates are entwined! Together, you've found a shared rhythm in the stars.</p>
                </div>
                {% for track in wrap.duowrap.top_tracks|slice:":3" %}
                <div class="details">
                    <img src="{{ track.image }}" height="33" width="33" alt="Track Image">
                    <div class="bullet">
                        <img class="fbullet-img" data-index="{{ forloop.counter }}" height="10px" width="10px" alt="Bullet Point">
                    </div>
                    <div class="text">
                        <h2>{{ track.name }}</h2>
                        <h3>{{ track.artists }}</h3>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Info for no shared tracks -->
            <div class="info fade" id="info1-none">
                <div class="scenario">
                    <p>The cards reveal a curious divergence—your musical fates have yet to intertwine. Explore new paths, and perhaps the stars will align for a shared melody.</p>
                </div>
            </div>
        </div>
    </div>


    <div class="card2" id="card">
        <div class="card-back" id="back2"></div>
        <div class="card-front" id="front2">
            <div class="info fade">
                <h1>Top Artists</h1>
                {% for artist in wrap.wrap1.top5artists %}
                    <div class="details">
                        <img src="{{ artist.image }}" width="33" height="33">
                        <div class="bullet">
                            <img class="fbullet-img" data-index="{{ forloop.counter }}" height="10px" width="10px">
                        </div>
                        <div class="text">
                            <h2>{{ artist.name }}</h2>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

    <script>
            const trackLen = {{ wrap.duowrap.numSharedTracks }};

            function setupTrackInfo() {
                const card = document.querySelector(".card1");
                const info = document.getElementById("info1");
                const none = document.getElementById("info1-none");

                card.addEventListener("mouseenter", () => {
                    if (trackLen !== 0) {
                        info.style.display = "flex";
                        none.style.display = "none";
                    } else {
                        info.style.display = "none";
                        none.style.display = "flex";
                    }
                });

                card.addEventListener("mouseleave", () => {
                    info.style.display = "none";
                    none.style.display = "none";
                });
            }

            document.addEventListener("DOMContentLoaded", setupTrackInfo);
        </script>
</div>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    function splitCard(card) {
        const front = card.querySelector(".card-front");
        front.style.opacity = "0"; // Hide the front
        const frontBackground = getComputedStyle(front).background;

        // Create split elements
        const leftHalf = document.createElement("div");
        leftHalf.classList.add("split-left");
        leftHalf.style.background = frontBackground; // Apply the front's background

        const rightHalf = document.createElement("div");
        rightHalf.classList.add("split-right");
        rightHalf.style.background = frontBackground; // Apply the front's background

        // Append split halves to the card
        card.appendChild(leftHalf);
        card.appendChild(rightHalf);
        // Restore the card-front after animation completes
        setTimeout(() => {
            leftHalf.remove();
            rightHalf.remove();

            // Fade the front card back in
            front.style.opacity = "1"; // Restore visibility
        }, 3000); // Duration of the split animation
    }

    let isAnimating = false;

    // Add event listener to cards
    const cards = document.querySelectorAll("#card");
    let flippedCards = new Set(); // Track cards that have been flipped

    cards.forEach(card => {
        card.addEventListener("click", function () {
            // Prevent interaction if already animating
            if (isAnimating) return;

            // Set flag to true
            isAnimating = true;

            const lastFlippedCard = Array.from(cards).find(c => c !== this && c.classList.contains("clicked"));
            if (lastFlippedCard) {
                lastFlippedCard.classList.remove("clicked", "flipped");
            }

            // Flip the card
            card.classList.toggle("clicked");

            // Check if all cards have been flipped at least once
            // Trigger split animation after flipping
            setTimeout(() => {
                if (card.classList.contains("clicked")) {
                    splitCard(card);
                }
            }, 600); // Matches flip animation duration

            // Reset flag after the entire animation ends
            setTimeout(() => {
                isAnimating = false;
            }, 3000); // Adjusted for split and reappear animation duration
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
            const bulletImages = document.querySelectorAll('.fbullet-img');

            bulletImages.forEach(function (bullet, index) {
                const bulletImages = [
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet1.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet2.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet3.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet4.svg' %}",
                    "{% static 'SpotifyWrapped/images/decorations/bullets/bullet5.svg' %}"
                ];

                bullet.src = bulletImages[index % bulletImages.length];
            });
        });
    </script>
</body>
</html>